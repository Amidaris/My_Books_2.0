{% extends "base.html" %}

{% block title %}WypoÅ¼yczenia{% endblock %}

{% block content %}
<a href="{{ url_for('new_borrowings') }}">
    <button>â• Dodaj wypoÅ¼yczenie</button>
</a>
<a href="{{ url_for('export_borrowings') }}">
    <button>ğŸ“¥ Pobierz wypoÅ¼yczenia (CSV)</button>
</a>

<h2>ğŸ“¦ Historia wypoÅ¼yczeÅ„</h2>
<form method="GET" action="{{ url_for('borrowings')}}" class="filter-row">
    <label for="status">Status wypoÅ¼yczenia:</label>
    <select name="status">
        <option value="">â€” Wszystkie â€”</option>
        <option value="active" {% if request.args.get('status') == 'active' %}selected{% endif %}>â³ W trakcie</option>
        <option value="returned" {% if request.args.get('status') == 'returned' %}selected{% endif %}>âœ… ZwrÃ³cona</option>
    </select>
    <button type="submit">ğŸ” Filtruj</button>
</form>

<table>
    <tr>
        <th>ID</th>
        <th>KsiÄ…Å¼ka</th>
        <th>ImiÄ™</th>
        <th>Nazwisko</th>
        <th>Data wypoÅ¼yczenia</th>
        <th>Data zwrotu</th>
        <th>Email</th>
        <th>Telefon</th>
        <th>Akcje</th>
        <th>Edycja</th>
    </tr>
    {% for b in borrowings %}
    <tr>
        <td>{{ b.id }}</td>
        <td>{{ b.book.title }}</td>
        <td>{{ b.borrower_name }}</td>
        <td>{{ b.borrower_surname }}</td>
        <td>{{ b.borrow_date.strftime('%Y-%m-%d') }}</td>
        <td>
            {% if b.return_date %}
            {{ b.return_date.strftime('%Y-%m-%d') }}
            {% else %}
            â³ W trakcie
            {% endif %}
        </td>
        <td>{{ b.email or "â€”" }}</td>
        <td>{{ b.phone or "â€”" }}</td>
        <td>
            {% if not b.return_date %}
            <form method="POST" action="{{ url_for('return_book', borrowing_id=b.id) }}">
                <button type="submit" onclick="return confirm('Czy na pewno chcesz zwrÃ³ciÄ‡ ksiÄ…Å¼kÄ™?')">ğŸ”„ ZwrÃ³Ä‡</button>
            </form>
            {% else %}
            âœ… ZwrÃ³cona
            {% endif %}
        </td>
        <td>
            <a href="{{ url_for('edit_borrowing', borrowing_id=b.id) }}">
                <button>âœï¸ Edytuj</button>
            </a>
        </td>
    </tr>
    {% endfor %}
</table>
{% endblock %}