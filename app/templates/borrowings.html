{% extends "base.html" %}

{% block title %}Wypożyczenia{% endblock %}

{% block content %}
<a href="{{ url_for('new_borrowings') }}">
    <button>➕ Dodaj wypożyczenie</button>
</a>
<a href="{{ url_for('export_borrowings') }}">
    <button>📥 Pobierz wypożyczenia (CSV)</button>
</a>

<h2>📦 Historia wypożyczeń</h2>
<form method="GET" action="{{ url_for('borrowings')}}" class="filter-row">
    <label for="status">Status wypożyczenia:</label>
    <select name="status">
        <option value="">— Wszystkie —</option>
        <option value="active" {% if request.args.get('status') == 'active' %}selected{% endif %}>⏳ W trakcie</option>
        <option value="returned" {% if request.args.get('status') == 'returned' %}selected{% endif %}>✅ Zwrócona</option>
    </select>
    <button type="submit">🔎 Filtruj</button>
</form>

<table>
    <tr>
        <th>ID</th>
        <th>Książka</th>
        <th>Imię</th>
        <th>Nazwisko</th>
        <th>Data wypożyczenia</th>
        <th>Data zwrotu</th>
        <th>Email</th>
        <th>Telefon</th>
        <th>Akcje</th>
        <th>Edycja</th>
    </tr>
    {% for b in borrowings %}
    <tr>
        <td>{{ b.id }}</td>
        <td>{{ b.book.title }}</td>
        <td>{{ b.borrower_name }}</td>
        <td>{{ b.borrower_surname }}</td>
        <td>{{ b.borrow_date.strftime('%Y-%m-%d') }}</td>
        <td>
            {% if b.return_date %}
            {{ b.return_date.strftime('%Y-%m-%d') }}
            {% else %}
            ⏳ W trakcie
            {% endif %}
        </td>
        <td>{{ b.email or "—" }}</td>
        <td>{{ b.phone or "—" }}</td>
        <td>
            {% if not b.return_date %}
            <form method="POST" action="{{ url_for('return_book', borrowing_id=b.id) }}">
                <button type="submit" onclick="return confirm('Czy na pewno chcesz zwrócić książkę?')">🔄 Zwróć</button>
            </form>
            {% else %}
            ✅ Zwrócona
            {% endif %}
        </td>
        <td>
            <a href="{{ url_for('edit_borrowing', borrowing_id=b.id) }}">
                <button>✏️ Edytuj</button>
            </a>
        </td>
    </tr>
    {% endfor %}
</table>
{% endblock %}